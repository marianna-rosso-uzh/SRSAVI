---
title: "NameTags"
output: html_document
date: "2024-09-13"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r message=FALSE, warning=FALSE}
library(ggplot2)
library(ggimage)
library(grid)
library(magick)
library(tidyverse)
```


```{r message=FALSE, warning=FALSE}
# Example data with names and affiliations
name_data <- data.frame(
  name = c("Marianna Rosso", "John Doe", "Jane Smith", "Michael Brown"),
  affiliation = c("University of ZÃ¼rich", "Stanford University", "Harvard", "MIT")
)

# Step 1: Create a new folder for saving the images
output_dir <- "name_tags_images"
dir.create(output_dir, showWarnings = FALSE)  # This will create the folder if it doesn't exist

# Step 2: Loop through the name_data data frame to generate and save name tag images
for (i in 1:nrow(name_data)) {
  
  # Create a grob for a rounded rectangle
  rounded_rect <- roundrectGrob(
    x = unit(0.5, "npc"),   # Horizontal position (normalized)
    y = unit(0.5, "npc"),   # Vertical position (normalized)
    width = unit(1, "npc"),  # Full width of the plot
    height = unit(1, "npc"),  # Full height of the plot
    r = unit(0.1, "snpc"),  # Corner radius
    gp = gpar(fill = NA, col = "black")  # Customize color (black border, no fill)
  )
  
  scale=0.5
  
  # Generate the name tag plot with dynamic content
  p <- data.frame(
    x = 1:10, 
    y = 1:10, 
    image = "images/logoESanimal.png"  # Path to your logo
  ) %>% 
    mutate(image = ifelse(x == 1, image, NA)) %>% 
    ggplot(aes(x = x, y = y)) +
    annotation_custom(rounded_rect) +  # Add the rounded rectangle
    geom_image(aes(image = image, x = 1.8, y = 3), size = 0.4) +  # Add the image
    annotate("text", x = 5, y = 8.5, label = name_data$name[i], size = 8, family = "TheSans Scd Trial") +  # Name
    annotate("text", x = 5, y = 7, label = name_data$affiliation[i], size = 4, family = "TheSans Scd Trial") +  # Affiliation
    annotate("text", x = 4, y = 4, label = "5th International", size = 3.5, family = "TheSans Scd Trial", hjust = 0, color = "#656565") +
    annotate("text", x = 4, y = 3, label = "SR-SAVI Conference", size = 5, family = "TheSans Scd Trial", hjust = 0, color = "#656565") +
    annotate("text", x = 4, y = 2, label = "Systematic Reviews of Studies in Animals and in Vitro", size = 2, family = "TheSans Scd Trial", hjust = 0, color = "#656565") +
    xlim(0, 10) +
    ylim(0, 10) +
    theme_minimal() +
    theme(panel.grid = element_blank(),
          axis.title = element_blank(),
          axis.text = element_blank())
  
  # Step 3: Save the plot as a PNG image in the new folder with specific size (10.5x8.5 cm)
  file_path <- file.path(output_dir, paste0("name_tag_", i, ".png"))
  ggsave(filename = file_path, plot = p, width = 10.5, height = 8.5, units = "cm")
}
```


```{r message=FALSE, warning=FALSE}
library(magick)

# Step 1: List all images from the folder
image_files <- list.files("name_tags_images", full.names = TRUE, pattern = "\\.png$")

# Step 2: Read all the images
img_list <- image_read(image_files)

# Step 3: Create a blank A4-sized canvas and place the images on it
a4_width <- 8.27 * 72  # A4 width in points (1 inch = 72 points)
a4_height <- 11.69 * 72  # A4 height in points

# Step 4: Ensure each image keeps its size (10.5x8.5 cm)
# Convert cm to points: 1 cm = 28.3465 points
img_resized <- image_scale(img_list, paste0(10.5 * 28.3465, "x", 8.5 * 28.3465))

# Step 5: Write the images to a PDF with A4 pages
image_write(img_resized, path = "name_tags_A4.pdf", format = "pdf", density = 300)

```













